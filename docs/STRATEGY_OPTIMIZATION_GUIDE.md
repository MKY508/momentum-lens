# 📊 动量策略参数优化实验指南

## 🎯 概述

本指南介绍如何使用 Momentum Lens 的**参数优化实验功能**，系统性地找到A股市场最优的动量策略配置。

### 核心价值

- ✅ **避免过拟合**：训练期(2015-2020) + 验证期(2021-2022) + 测试期(2023-2024)
- ✅ **科学评估**：综合夏普、回撤、换手、跨期稳定性
- ✅ **实盘可用**：输出直接可用的配置参数
- ✅ **全流程自动化**：从粗筛到精调，一键完成

---

## 🚀 快速开始

### 方式1：CLI菜单（推荐）

```bash
./momentum_lens.sh

# 导航路径：
主菜单 → [3] 回测与动量工具
      → [8] 实验性：科学动量回测
      → [4] 参数优化实验 - 完整流程（~20分钟）
```

### 方式2：命令行直接运行

```bash
# 完整流程
~/rqalpha_env/bin/python scripts/experiments/batch_backtest.py --full

# 或分步执行
~/rqalpha_env/bin/python scripts/experiments/batch_backtest.py --phase 1  # 粗筛
~/rqalpha_env/bin/python scripts/experiments/batch_backtest.py --phase 2  # 精调
```

---

## 📋 实验设计

### 阶段1：粗筛（~2分钟）

**目标**：从4个策略中初筛

**测试策略**：
1. **slow-core** - 慢腿·核心监控（3M-1M + 6M-1M）
2. **blend-dual** - 双窗·原始动量（3M + 6M）
3. **twelve-minus-one** - 12M-1M 长波
4. **fast-rotation** - 快线·轮动观察（20D + 3M）

**固定参数**：
- 调仓频率：月度
- 持仓数量：2只
- 观察期：1个月
- 相关性阈值：0.7

**时间段**：训练期（2015-2020）

**输出**：
- 4个策略的训练期夏普排名
- 选出Top 3进入精调

---

### 阶段2：精调（~15分钟）

**目标**：为Top 3策略寻找最优参数

**参数网格**：
- **调仓频率**：月度、周度（2种）
- **持仓数量**：1只、2只、3只（3种）
- **观察期**：0月、1月、2月（3种）
- **相关性阈值**：0.6、0.7、0.8（3种）

**组合数量**：3策略 × 2频率 × 3持仓 × 3观察期 × 3相关性 = **162种**

**时间段**：
- 训练期（2015-2020）
- 验证期（2021-2022）
- 测试期（2023-2024）

**评估指标**：
```python
综合得分 = 0.4 × 测试期夏普 +
          0.3 × 跨期稳定性 +
          0.2 × 回撤控制 +
          0.1 × 成本效率
```

**输出**：
- 162种配置的完整评估
- 最优配置推荐
- CSV结果文件

---

## 📊 结果解读

### 查看结果

在CLI中：
```
主菜单 → [3] 回测与动量工具
      → [8] 实验性：科学动量回测
      → [5] 查看优化结果
```

### 输出文件

```
results/
├── phase1_coarse_YYYYMMDD_HHMMSS.csv      # 阶段1粗筛结果
└── phase2_fine_YYYYMMDD_HHMMSS.csv        # 阶段2精调结果
```

### 关键指标说明

| 指标 | 含义 | 优秀标准 |
|------|------|----------|
| **sharpe_test** | 测试期夏普比率 | > 1.0 |
| **return_test** | 测试期年化收益 | > 10% |
| **maxdd_test** | 测试期最大回撤 | < 20% |
| **turnover** | 年化换手率 | < 2.0 |
| **stability** | 跨期稳定性 | > 0.7 |
| **score** | 综合得分 | 越高越好 |

### 示例输出

```
🏆 推荐配置
============================================================
策略: slow-core
调仓频率: monthly
持仓数量: 2
观察期: 1个月
相关性阈值: 0.70

测试期夏普: 1.25
测试期年化收益: 15.3%
最大回撤: -12.5%
年化换手率: 1.8倍
综合得分: 0.8523
```

---

## 💡 策略选择指南

基于实验结果，根据不同场景选择策略：

### 1. 长期持有（推荐新手）

**策略**：slow-core
- **特点**：剔除近月噪音，趋势稳定
- **调仓**：月度
- **持仓**：2只
- **观察期**：1-2个月
- **适合**：不想频繁操作，追求稳健收益

### 2. 牛市追涨

**策略**：fast-rotation
- **特点**：捕捉短期轮动，反应灵敏
- **调仓**：周度
- **持仓**：3只
- **观察期**：0个月
- **适合**：牛市中追求高收益，能承受高波动

### 3. 震荡市防守

**策略**：blend-dual
- **特点**：平衡短中期信号，攻守兼备
- **调仓**：月度
- **持仓**：2只
- **观察期**：1个月
- **适合**：市场方向不明时的稳健配置

### 4. 长期趋势

**策略**：twelve-minus-one
- **特点**：聚焦年度趋势，滤除短期波动
- **调仓**：月度
- **持仓**：2只
- **观察期**：2个月
- **适合**：配置型投资，长期持有

---

## 🔧 实盘操作流程

### 月度操作清单

**时间**：每月最后一个交易日

**步骤**：

1. **运行分析**
   ```bash
   ./momentum_lens.sh
   → [2] 自定义运行动量分析
   → 选择最优策略（如 slow-core）
   → 输入参数（使用实验推荐值）
   ```

2. **查看建议持仓**
   - 报告末尾会显示 Top N 标的
   - 记录建议持仓列表

3. **计算换仓需求**
   ```
   当前持有：A、B
   新建议：  B、C
   操作：    卖出 A，买入 C，保留 B
   ```

4. **执行交易**
   - 盘后下单或次日开盘
   - 只操作有变化的标的（降低成本）

5. **记录数据**
   - 换仓日期
   - 持仓变化
   - 实际成本

### 观察期机制说明

**观察期 = N 个月**：标的需连续N个月不在Top名单，才真正淘汰

**示例**（观察期=1）：
```
1月调仓：选中 A、B
2月调仓：TopN = B、C
         → 保留 B（仍在名单）
         → 保留 A（观察期计数=1，宽容一次）
         → 买入 C 补足持仓

3月调仓：TopN = C、D
         → 保留 C
         → 卖出 A（计数=2，超过观察期）
         → 保留 B（虽不在名单，但重置观察期）
```

**优势**：
- 减少噪音交易
- 降低换手成本
- 避免频繁换仓

---

## ⚠️ 风险控制

### 1. 仓位控制

- **单只权重上限**：
  - 持仓2只：每只 ≤ 50%
  - 持仓3只：每只 ≤ 33%

- **相关性过滤**：
  - 优选相关性 < 0.7 的标的
  - 避免集中下行风险

### 2. 止损规则

```
IF Satellite账面亏损 > 15%:
    暂停动量策略
    转持短债ETF（511360.XSHG）
    等待市场企稳后重新启动
```

### 3. 市场状态适应

**趋势市**（MA200上方 & CHOP<38）：
- Satellite仓位：40%
- 持仓数量：2只
- 进攻性配置

**震荡/熊市**（其他情况）：
- Satellite仓位：20%
- 持仓数量：1只
- 防守性配置

---

## 🔬 实验性策略（5个新增）

这些策略已加入预设库，但需要特殊的计算逻辑支持（未来版本实现）：

### 1. sharpe-momentum（夏普动量·风险调整）
- **公式**：Score = (6M-1M收益) / 6M波动率
- **优势**：自动降低高波资产权重
- **适合**：风险厌恶型投资者

### 2. alpha-residual（残差Alpha·市场中性）
- **公式**：对沪深300回归后取残差
- **优势**：剔除市场Beta，捕捉纯Alpha
- **适合**：追求超额收益，降低系统性风险

### 3. trend-quality（趋势质量·信号过滤）
- **公式**：动量 × 趋势强度(ADX>25 & CHOP<38 & 价格>EMA60)
- **优势**：只在趋势明确时持仓
- **适合**：震荡市保护需求强

### 4. rank-percentile（截面排名·分位强度）
- **公式**：截面标准化，只选排名前20%
- **优势**：相对排名更稳定
- **适合**：减少极端值影响

### 5. composite-factor（复合因子·全天候）
- **公式**：动量(50%) + 低波(30%) + 质量(20%)
- **优势**：平衡收益与风险
- **适合**：长期配置型投资

---

## 📚 附录

### A. Core-Satellite架构说明

**Core（60%，长期持有）**：
```
510300.XSHG (沪深300)    20%
510880.XSHG (红利低波)    10%
511360.XSHG (短债)        15%
518880.XSHG (黄金)        10%
513500.XSHG (标普500)      5%
```

**Satellite（30-40%，动量轮动）**：
- 行业ETF：能源、医疗、白酒、半导体、光伏、新能源车等
- 风格ETF：中证500、中证1000、创业板50、科创50等
- 动态调整：根据动量得分每月轮动

### B. 候选ETF池

**行业主题（12只）**：
- 512980.XSHG (能源)
- 512170.XSHG (医疗)
- 512690.XSHG (白酒)
- 512480.XSHG (半导体)
- 515790.XSHG (光伏)
- 516160.XSHG (新能源车)
- 159995.XSHE (芯片)
- 513100.XSHG (纳指100)
- 513050.XSHG (中概互联)
- 159949.XSHE (创业板50)
- 588000.XSHG (科创50)
- 512260.XSHG (中证1000)

**宽基指数（3只）**：
- 510500.XSHG (中证500)
- 510300.XSHG (沪深300)
- 510050.XSHG (上证50)

### C. 成本假设

**交易成本**：
- 佣金：万0.5 (0.00005)
- 滑点：0.05% (0.0005)
- 合计：0.055% /次

**年化成本**：
- 月度调仓：0.055% × 换手率 × 12
- 周度调仓：0.055% × 换手率 × 52

**换手率定义**：
```python
换手率 = Σ|Δ权重| / 2
```

### D. 常见问题

**Q1: 实验需要多长时间？**
- 阶段1（粗筛）：~2分钟
- 阶段2（精调）：~15分钟
- 完整流程：~20分钟

**Q2: 需要多少历史数据？**
- 建议：2015年至今的完整数据
- 最低：2020年至今（但评估不够全面）

**Q3: 多久需要重新优化？**
- 建议每年重新运行一次
- 市场环境剧变时（如牛熊切换）可提前重跑

**Q4: 推荐配置会变吗？**
- 会，随着新数据加入，最优配置可能变化
- 但核心规律（如观察期、相关性阈值）相对稳定

**Q5: 如何选择调仓频率？**
- 月度：适合大多数人，成本低、操作简单
- 周度：追求高频轮动，需要更多精力
- 建议从月度开始

---

## 🎓 延伸阅读

1. **动量理论基础**
   - Jegadeesh & Titman (1993) - Returns to Buying Winners and Selling Losers
   - Asness et al. (2013) - Value and Momentum Everywhere

2. **避免过拟合**
   - Bailey et al. (2014) - The Probability of Backtest Overfitting
   - Harvey et al. (2016) - ...and the Cross-Section of Expected Returns

3. **A股市场特性**
   - 反转效应：短期(<1月)、长期(>12月)
   - 动量效应：中期(3-12月)
   - 板块轮动：A股特有的高频特征

---

## 📧 反馈与支持

如有问题或建议，欢迎：
- 提交 GitHub Issue
- 查阅项目文档：`docs/`
- 运行示例测试：`pytest tests/`

---

**祝投资顺利！** 🚀
