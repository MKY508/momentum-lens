# ETFæ”¶ç›Šç‡è®¡ç®—æœªè€ƒè™‘åˆ†çº¢å¯¼è‡´æ’åä¸¥é‡å¤±çœŸ

## é—®é¢˜æè¿°

ç³»ç»Ÿåœ¨è®¡ç®—ETFåŠ¨é‡æ’åæ—¶ä½¿ç”¨å•ä½å‡€å€¼(Unit NAV)è®¡ç®—æ”¶ç›Šç‡ï¼Œæœªè€ƒè™‘åˆ†çº¢é™¤æƒçš„å½±å“ï¼Œå¯¼è‡´é«˜åˆ†çº¢ETFï¼ˆå¦‚é“¶è¡ŒETFï¼‰çš„æ”¶ç›Šç‡ä¸¥é‡å¤±çœŸï¼Œæ’åé”™è¯¯ã€‚

## å½±å“èŒƒå›´

- **ä¸¥é‡ç¨‹åº¦**: ğŸ”´ Critical
- **å½±å“æ¨¡å—**: 
  - åç«¯: `/api/market/momentum-rankings` æ¥å£
  - å‰ç«¯: SatelliteModule ç»„ä»¶
  - æ•°æ®: æ‰€æœ‰åˆ†çº¢ETFçš„åŠ¨é‡è¯„åˆ†å’Œæ’å

## å…·ä½“æ¡ˆä¾‹

### æ¡ˆä¾‹1: é“¶è¡ŒETF (512800) 

**é—®é¢˜æ—¶é—´**: 2025å¹´8æœˆ25æ—¥

**é”™è¯¯è¡¨ç°**:
- åä¹‰60æ—¥æ”¶ç›Šç‡: -47.24%
- åä¹‰120æ—¥æ”¶ç›Šç‡: -42.66%
- åŠ¨é‡è¯„åˆ†: -45.41
- æ’å: ç¬¬12åï¼ˆå«åº•ï¼‰

**å®é™…æƒ…å†µ**:
- 2025å¹´7æœˆ4æ—¥åˆ†çº¢: 0.857å…ƒ/ä»½
- åˆ†çº¢å‰ä»·æ ¼: 1.77å…ƒ
- åˆ†çº¢åä»·æ ¼: 0.89å…ƒï¼ˆé™¤æƒï¼‰
- çœŸå®60æ—¥æ”¶ç›Šç‡: +5.80%ï¼ˆå«åˆ†çº¢ï¼‰
- çœŸå®120æ—¥æ”¶ç›Šç‡: +4.50%ï¼ˆå«åˆ†çº¢ï¼‰
- æ­£ç¡®åŠ¨é‡è¯„åˆ†: +5.29
- æ­£ç¡®æ’å: ç¬¬11å

**å½±å“**: 53.04%çš„æ”¶ç›Šç‡å·®å¼‚ï¼Œå®Œå…¨é¢ å€’äº†æŠ•èµ„å†³ç­–

### æ¡ˆä¾‹2: åˆ¸å•†ETF (512000)

**é”™è¯¯è¡¨ç°**:
- åä¹‰60æ—¥æ”¶ç›Šç‡: -35.91%
- åä¹‰120æ—¥æ”¶ç›Šç‡: -39.55%
- åŠ¨é‡è¯„åˆ†: -37.36
- æ’å: ç¬¬11å

**å®é™…æƒ…å†µ**:
- å­˜åœ¨å¤§é¢åˆ†çº¢ï¼ˆæ¨æµ‹çº¦1.0å…ƒ/ä»½ï¼‰
- çœŸå®60æ—¥æ”¶ç›Šç‡: +28.09%ï¼ˆå«åˆ†çº¢ï¼‰
- çœŸå®120æ—¥æ”¶ç›Šç‡: -20.65%ï¼ˆå«åˆ†çº¢ï¼‰
- æ­£ç¡®åŠ¨é‡è¯„åˆ†: +8.75
- æ­£ç¡®æ’å: ç¬¬10å

**å½±å“**: 64.00%çš„æ”¶ç›Šç‡å·®å¼‚ï¼Œä»å·¨äºå˜ä¸ºç›ˆåˆ©28%

## æ ¹æœ¬åŸå› 

1. **æ•°æ®æºé—®é¢˜**: ä½¿ç”¨ä»·æ ¼æ•°æ®è€Œéç´¯è®¡å‡€å€¼
   ```python
   # é”™è¯¯æ–¹å¼
   return_rate = (current_price / past_price - 1) * 100
   
   # æ­£ç¡®æ–¹å¼
   return_rate = (current_nav / past_nav - 1) * 100  # ä½¿ç”¨ç´¯è®¡å‡€å€¼
   ```

2. **åˆ†çº¢äº‹ä»¶æœªå¤„ç†**: ç³»ç»Ÿæœªæ£€æµ‹å’Œè°ƒæ•´åˆ†çº¢é™¤æƒäº‹ä»¶

3. **æ•°æ®éªŒè¯ç¼ºå¤±**: ç¼ºå°‘å¤šæ•°æ®æºäº¤å‰éªŒè¯æœºåˆ¶

## è§£å†³æ–¹æ¡ˆ

### 1. åˆ›å»ºETFæ•°æ®å¤„ç†å™¨ (`etf_data_handler.py`)

```python
class ETFDataHandler:
    def detect_dividend_events(self, df: pd.DataFrame, threshold: float = 0.15):
        """æ£€æµ‹åˆ†çº¢é™¤æƒäº‹ä»¶ï¼ˆå•æ—¥è·Œå¹…>15%ï¼‰"""
        
    def get_adjusted_prices(self, code: str, use_nav: bool = True):
        """è·å–å¤æƒåçš„ä»·æ ¼æ•°æ®ï¼Œä¼˜å…ˆä½¿ç”¨ç´¯è®¡å‡€å€¼"""
        
    def calculate_returns_with_dividend(self, code: str, periods: List[int]):
        """è®¡ç®—è€ƒè™‘åˆ†çº¢çš„çœŸå®æ”¶ç›Šç‡"""
```

### 2. å¤šæ•°æ®æºéªŒè¯

```python
def verify_with_multiple_sources(self, code: str, name: str):
    """
    ä½¿ç”¨å¤šä¸ªæ•°æ®æºéªŒè¯ETFæ•°æ®
    - ä¸œæ–¹è´¢å¯Œ (fund_etf_hist_em)
    - æ–°æµªè´¢ç» (fund_etf_hist_sina)
    - åŸºé‡‘å‡€å€¼ (fund_etf_fund_info_em)
    """
```

### 3. å‰ç«¯æ˜¾ç¤ºä¼˜åŒ–

- æ·»åŠ åˆ†çº¢æ ‡è¯†
- æ˜¾ç¤ºçœŸå®æ”¶ç›Šç‡vsåä¹‰æ”¶ç›Šç‡
- æ©™è‰²æ ‡è®°è¡¨ç¤ºæœ‰åˆ†çº¢å½±å“

```typescript
interface MomentumETF {
  r60: number;           // çœŸå®æ”¶ç›Šç‡
  r60_nominal?: number;  // åä¹‰æ”¶ç›Šç‡
  has_dividend?: boolean;
  dividend_impact?: number;
}
```

## æµ‹è¯•éªŒè¯

### éªŒè¯è„šæœ¬
```bash
python test_dividend_adjustment.py
```

### é¢„æœŸç»“æœ
```
é“¶è¡ŒETFéªŒè¯ç»“æœ:
  çœŸå®60æ—¥æ”¶ç›Š: 5.80%
  åä¹‰60æ—¥æ”¶ç›Š: -47.24%
  åˆ†çº¢å½±å“: 53.04%
  åŠ¨é‡è¯„åˆ†: 5.29
```

## ä¿®å¤åçš„APIå“åº”

```json
{
  "code": "512800",
  "name": "é“¶è¡ŒETF",
  "score": 5.29,
  "r60": 5.8,
  "r120": 4.5,
  "r60_nominal": -47.24,
  "r120_nominal": -42.66,
  "has_dividend": true,
  "dividend_impact": 53.04
}
```

## é¢„é˜²æªæ–½

1. **ä½¿ç”¨ç´¯è®¡å‡€å€¼è€Œéå•ä½å‡€å€¼**
2. **å®æ–½åˆ†çº¢äº‹ä»¶è‡ªåŠ¨æ£€æµ‹**
3. **å¤šæ•°æ®æºäº¤å‰éªŒè¯**
4. **æ·»åŠ æ•°æ®è´¨é‡ç›‘æ§å‘Šè­¦**
5. **å®šæœŸéªŒè¯é«˜åˆ†çº¢ETFæ•°æ®**

## ç›¸å…³æ–‡ä»¶

- `backend/etf_data_handler.py` - åˆ†çº¢è°ƒæ•´å¤„ç†å™¨
- `backend/main_lite.py` - APIç«¯ç‚¹æ›´æ–°
- `frontend/src/types/index.ts` - ç±»å‹å®šä¹‰æ›´æ–°
- `frontend/src/components/Satellite/SatelliteModule.tsx` - UIæ˜¾ç¤ºæ›´æ–°

## å‚è€ƒèµ„æ–™

- [ETFåˆ†çº¢é™¤æƒè§„åˆ™](https://www.sse.com.cn/etf)
- [ç´¯è®¡å‡€å€¼vså•ä½å‡€å€¼](https://fund.eastmoney.com)
- AKShareæ–‡æ¡£: `fund_etf_fund_info_em` æ¥å£

## æ ‡ç­¾

`bug` `critical` `data-accuracy` `dividend-adjustment` `etf`